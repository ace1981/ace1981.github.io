<!DOCTYPE html>
<html>
  
  <body>
    <div class="container">
      <header class="header">
  <div class="blog-title">
    <a href="/" class="logo">Ace&#39;pages</a>
    <div class="subtitle"></div>
  </div>
  <nav class="navbar">
    <ul class="menu">
      
        <li class="menu-item">
          <a href="/" class="menu-item-link">主页</a>
        </li>
      
        <li class="menu-item">
          <a href="/archives" class="menu-item-link">归档</a>
        </li>
      
        <li class="menu-item">
          <a href="/about" class="menu-item-link">关于</a>
        </li>
      
    </ul>
  </nav>
</header>
<article class="post">
  <div class="post-title">
    <h1 class="article-title">springboot构建elk+log4j的日志收集最简方式</h1>
  </div>
   <div class="post-meta">
    <span class="post-time">2017-05-16</span>
  </div>
  <div class="post-content">
    <p>环境搭建参考前章</p>
<p><a href="http://hujao.com/2017/04/23/docker-elasticsearch/">docker搭建elasticsearch</a></p>
<p><a href="http://hujao.com/2017/05/15/docker-logstash/">docker构建logstash</a></p>
<p><a href="http://hujao.com/2017/05/15/docker-kibana/">docker构建kibana</a></p>
<p>修改pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">exclusions</span>&gt;</span></div><div class="line">        <span class="tag">&lt;<span class="name">exclusion</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-logging<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">        <span class="tag">&lt;/<span class="name">exclusion</span>&gt;</span></div><div class="line">    <span class="tag">&lt;/<span class="name">exclusions</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<p>在resources目录添加log4j.properties</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line">log4j.rootLogger = INFO,logstash,CONSOLE,APPLOG,ERRORLOG</div><div class="line"></div><div class="line">log4j.appender.logstash=org.apache.log4j.net.SocketAppender</div><div class="line">log4j.appender.logstash.Port=3456</div><div class="line">log4j.appender.logstash.RemoteHost=elasticsearch_IP</div><div class="line">log4j.appender.logstash.ReconnectionDelay=60000</div><div class="line">log4j.appender.logstash.LocationInfo=true</div><div class="line"></div><div class="line">log4j.appender.CONSOLE=org.apache.log4j.ConsoleAppender</div><div class="line">log4j.appender.CONSOLE.Target=System.out</div><div class="line">log4j.appender.CONSOLE.layout=org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.CONSOLE.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p [%t] %c %x - %m%n</div><div class="line"></div><div class="line">log4j.appender.APPLOG=org.apache.log4j.DailyRollingFileAppender</div><div class="line">log4j.appender.APPLOG.Append=true</div><div class="line">log4j.appender.APPLOG.DatePattern=&apos;_&apos;yyyyMMdd&apos;.log&apos;</div><div class="line">log4j.appender.APPLOG.layout=org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.APPLOG.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p [%t] %c %x - %m%n</div><div class="line">log4j.appender.APPLOG.File=../logs/AppAccessLog</div><div class="line"></div><div class="line">log4j.appender.ERRORLOG=org.apache.log4j.DailyRollingFileAppender</div><div class="line">log4j.appender.ERRORLOG.Threshold=ERROR</div><div class="line">log4j.appender.ERRORLOG.Append=true</div><div class="line">log4j.appender.ERRORLOG.DatePattern=&apos;_&apos;yyyyMMdd&apos;.log&apos;</div><div class="line">log4j.appender.ERRORLOG.layout=org.apache.log4j.PatternLayout</div><div class="line">log4j.appender.ERRORLOG.layout.ConversionPattern=%d&#123;yyyy-MM-dd HH:mm:ss&#125; %-5p [%t] %c %x - %m%n</div><div class="line">log4j.appender.ERRORLOG.File=../logs/AppErrorLog</div></pre></td></tr></table></figure>
<p>java代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> org.apache.log4j.Logger;</div><div class="line"></div><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> Logger logger = Logger.getLogger(<span class="keyword">this</span>.getClass());</div></pre></td></tr></table></figure>

  </div>
  <div class="post-footer">
    
      <ul class="post-tag-list"><li class="post-tag-list-item"><a class="post-tag-list-link" href="/tags/springboot/">springboot</a></li></ul>
    

    <a href="#top" class="top">返回顶部</a>
  </div>
</article>
<footer>
  &copy; 2017
  <span class="author">
    ace1981
  </span>
</footer>
    </div>
  </body>
</html>