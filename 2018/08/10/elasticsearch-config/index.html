<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  
  <title>elasticsearch-配置 | Ace&#39;pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="配置文件 $ES_HOME/config elasticsearch.yml for configuring Elasticsearch jvm.options for configuring Elasticsearch JVM settings log4j2.properties for configuring Elasticsearch logging  12#自定义配置文件目录ES_PATH">
<meta name="keywords" content="elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="elasticsearch-配置">
<meta property="og:url" content="http://hujao.com/2018/08/10/elasticsearch-config/index.html">
<meta property="og:site_name" content="Ace&#39;pages">
<meta property="og:description" content="配置文件 $ES_HOME/config elasticsearch.yml for configuring Elasticsearch jvm.options for configuring Elasticsearch JVM settings log4j2.properties for configuring Elasticsearch logging  12#自定义配置文件目录ES_PATH">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2018-08-09T23:30:22.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="elasticsearch-配置">
<meta name="twitter:description" content="配置文件 $ES_HOME/config elasticsearch.yml for configuring Elasticsearch jvm.options for configuring Elasticsearch JVM settings log4j2.properties for configuring Elasticsearch logging  12#自定义配置文件目录ES_PATH">
  
    <link rel="alternate" href="/atom.xml" title="Ace&#39;pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>

  
    
      <body>
    
  
      <div id="container" class="container">
        <article id="post-elasticsearch-config" class="article article-type-post" itemscope itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/tags/docker">Docker</a>
    
      <a class="main-nav-link" href="/tags/springboot">SpringBoot</a>
    
      <a class="main-nav-link" href="/tags/elasticsearch">ElasticSearch</a>
    
      <a class="main-nav-link" href="/tags/test">Test</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr/>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      elasticsearch-配置
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <h5 id="配置文件-ES-HOME-config"><a href="#配置文件-ES-HOME-config" class="headerlink" title="配置文件 $ES_HOME/config"></a>配置文件 $ES_HOME/config</h5><ul>
<li><code>elasticsearch.yml</code> for configuring Elasticsearch</li>
<li><code>jvm.options</code> for configuring Elasticsearch JVM settings</li>
<li><code>log4j2.properties</code> for configuring Elasticsearch logging</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#自定义配置文件目录</span><br><span class="line">ES_PATH_CONF=/path/to/my/config ./bin/elasticsearch</span><br></pre></td></tr></table></figure>
<h5 id="YMAL格式配置"><a href="#YMAL格式配置" class="headerlink" title="YMAL格式配置"></a>YMAL格式配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">path:</span><br><span class="line">    data: /var/lib/elasticsearch</span><br><span class="line">    logs: /var/log/elasticsearch</span><br></pre></td></tr></table></figure>
<p>或</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">path.data: /var/lib/elasticsearch</span><br><span class="line">path.logs: /var/log/elasticsearch</span><br></pre></td></tr></table></figure>
<h5 id="参数化"><a href="#参数化" class="headerlink" title="参数化"></a>参数化</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">node.name:    $&#123;HOSTNAME&#125;</span><br><span class="line">network.host: $&#123;ES_NETWORK_HOST&#125;</span><br></pre></td></tr></table></figure>
<h5 id="启动是通过提示配置"><a href="#启动是通过提示配置" class="headerlink" title="启动是通过提示配置"></a>启动是通过提示配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node:</span><br><span class="line">  name: $&#123;prompt.text&#125;</span><br><span class="line">#Enter value for [node.name]:</span><br></pre></td></tr></table></figure>
<h5 id="配置JVM"><a href="#配置JVM" class="headerlink" title="配置JVM"></a>配置JVM</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">lines beginning with a - are treated as a JVM option that applies independent of the version of the JVM</span><br><span class="line"></span><br><span class="line">-Xmx2g</span><br><span class="line">lines beginning with a number followed by a : followed by a - are treated as a JVM option that applies only if the version of the JVM matches the number</span><br><span class="line"></span><br><span class="line">8:-Xmx2g</span><br><span class="line">lines beginning with a number followed by a - followed by a : are treated as a JVM option that applies only if the version of the JVM is greater than or equal to the number</span><br><span class="line"></span><br><span class="line">8-:-Xmx2g</span><br><span class="line">lines beginning with a number followed by a - followed by a number followed by a : are treated as a JVM option that applies only if the version of the JVM falls in the range of the two numbers</span><br><span class="line"></span><br><span class="line">8-9:-Xmx2g</span><br></pre></td></tr></table></figure>
<h5 id="安全配置"><a href="#安全配置" class="headerlink" title="安全配置"></a>安全配置</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Creating the keystoreedit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">To create the elasticsearch.keystore, use the create <span class="built_in">command</span>:</span></span><br><span class="line">bin/elasticsearch-keystore create</span><br><span class="line"><span class="meta">#</span><span class="bash">The file elasticsearch.keystore will be created alongside <span class="comment">#elasticsearch.yml.</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Listing settings <span class="keyword">in</span> the keystoreedit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">A list of the settings <span class="keyword">in</span> the keystore is available with the list <span class="comment">#command:</span></span></span><br><span class="line">bin/elasticsearch-keystore list</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Adding string settingsedit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">Sensitive string settings, like authentication credentials <span class="keyword">for</span> cloud <span class="comment">#plugins, can be added using the add command:</span></span></span><br><span class="line">bin/elasticsearch-keystore add the.setting.name.to.set</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">The tool will prompt <span class="keyword">for</span> the value of the setting. To pass the value <span class="comment">#through stdin, use the --stdin flag:</span></span></span><br><span class="line">cat /file/containing/setting/value | bin/elasticsearch-keystore add --stdin the.setting.name.to.set</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">Removing settingsedit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">To remove a setting from the keystore, use the remove <span class="built_in">command</span>:</span></span><br><span class="line">bin/elasticsearch-keystore remove the.setting.name.to.remove</span><br></pre></td></tr></table></figure>
<h5 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">ppender.rolling.type = RollingFile </span><br><span class="line">appender.rolling.name = rolling</span><br><span class="line">appender.rolling.fileName = $&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;.log </span><br><span class="line">appender.rolling.layout.type = PatternLayout</span><br><span class="line">appender.rolling.layout.pattern = [%d&#123;ISO8601&#125;][%-5p][%-25c&#123;1.&#125;] %marker%.-10000m%n</span><br><span class="line">appender.rolling.filePattern = $&#123;sys:es.logs.base_path&#125;$&#123;sys:file.separator&#125;$&#123;sys:es.logs.cluster_name&#125;-%d&#123;yyyy-MM-dd&#125;-%i.log.gz </span><br><span class="line">appender.rolling.policies.type = Policies</span><br><span class="line">appender.rolling.policies.time.type = TimeBasedTriggeringPolicy </span><br><span class="line">appender.rolling.policies.time.interval = 1 </span><br><span class="line">appender.rolling.policies.time.modulate = true </span><br><span class="line">appender.rolling.policies.size.type = SizeBasedTriggeringPolicy </span><br><span class="line">appender.rolling.policies.size.size = 256MB </span><br><span class="line">appender.rolling.strategy.type = DefaultRolloverStrategy</span><br><span class="line">appender.rolling.strategy.fileIndex = nomax</span><br><span class="line">appender.rolling.strategy.action.type = Delete </span><br><span class="line">appender.rolling.strategy.action.basepath = $&#123;sys:es.logs.base_path&#125;</span><br><span class="line">appender.rolling.strategy.action.condition.type = IfFileName </span><br><span class="line">appender.rolling.strategy.action.condition.glob = $&#123;sys:es.logs.cluster_name&#125;-* </span><br><span class="line">appender.rolling.strategy.action.condition.nested_condition.type = IfAccumulatedFileSize </span><br><span class="line">appender.rolling.strategy.action.condition.nested_condition.exceeds = 2GB</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#日志删除</span><br><span class="line">appender.rolling.strategy.type = DefaultRolloverStrategy </span><br><span class="line">appender.rolling.strategy.action.type = Delete </span><br><span class="line">appender.rolling.strategy.action.basepath = $&#123;sys:es.logs.base_path&#125; </span><br><span class="line">appender.rolling.strategy.action.condition.type = IfFileName </span><br><span class="line">appender.rolling.strategy.action.condition.glob = $&#123;sys:es.logs.cluster_name&#125;-* </span><br><span class="line">appender.rolling.strategy.action.condition.nested_condition.type = IfLastModified </span><br><span class="line">appender.rolling.strategy.action.condition.nested_condition.age = 7D</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#日志级别</span><br><span class="line">logger.deprecation.level = warn</span><br></pre></td></tr></table></figure>
<h5 id="关键的ES配置"><a href="#关键的ES配置" class="headerlink" title="关键的ES配置"></a>关键的ES配置</h5><ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/path-settings.html" target="_blank" rel="noopener">Path settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/cluster.name.html" target="_blank" rel="noopener">Cluster name</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/node.name.html" target="_blank" rel="noopener">Node name</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/network.host.html" target="_blank" rel="noopener">Network host</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/discovery-settings.html" target="_blank" rel="noopener">Discovery settings</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-size.html" target="_blank" rel="noopener">Heap size</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/heap-dump-path.html" target="_blank" rel="noopener">Heap dump path</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/gc-logging.html" target="_blank" rel="noopener">GC logging</a></li>
</ul>
<h5 id="关键的系统配置"><a href="#关键的系统配置" class="headerlink" title="关键的系统配置"></a>关键的系统配置</h5><p>The following settings <strong>must</strong> be considered before going to production:</p>
<ul>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/setup-configuration-memory.html" target="_blank" rel="noopener">Disable swapping</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/file-descriptors.html" target="_blank" rel="noopener">Increase file descriptors</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/vm-max-map-count.html" target="_blank" rel="noopener">Ensure sufficient virtual memory</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/max-number-of-threads.html" target="_blank" rel="noopener">Ensure sufficient threads</a></li>
<li><a href="https://www.elastic.co/guide/en/elasticsearch/reference/current/networkaddress-cache-ttl.html" target="_blank" rel="noopener">JVM DNS cache settings</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2018/08/10/elasticsearch-config/" class="article-date">
  <time datetime="2018-08-09T23:10:14.000Z" itemprop="datePublished">2018-08-10</time>
</a>

        </li>
        
        
          <li>
            <span class="label">Tag:</span>
            
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elasticsearch/">elasticsearch</a></li></ul>


          </li>
        
        <hr/>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2018/08/22/elasticsearch-fieldtype/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          elasticsearch-字段类型
        
      </div>
    </a>
  
  
    <a href="/2018/08/07/elasticsearch-searchapi/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">elasticsearch-查询API</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr/>
      <div id="footerContent" class="footer-content">
        <p>闲步山雨后,静待晚林风 Post</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
