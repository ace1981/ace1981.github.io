<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>angular2-pipe | Ace&#39;pages</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="1&amp;#123;&amp;#123; 输入数据 | 管道 : 管道参数&amp;#125;&amp;#125; Angular 2 内建管道及分类 String -&amp;gt; String UpperCasePipe LowerCasePipe TitleCasePipe   Number -&amp;gt; String DecimalPipe PercentPipe CurrencyPipe   Object -&amp;gt; Str">
<meta property="og:type" content="article">
<meta property="og:title" content="angular2-pipe">
<meta property="og:url" content="http://hujao.com/2020/04/06/angular2-pipe/index.html">
<meta property="og:site_name" content="Ace&#39;pages">
<meta property="og:description" content="1&amp;#123;&amp;#123; 输入数据 | 管道 : 管道参数&amp;#125;&amp;#125; Angular 2 内建管道及分类 String -&amp;gt; String UpperCasePipe LowerCasePipe TitleCasePipe   Number -&amp;gt; String DecimalPipe PercentPipe CurrencyPipe   Object -&amp;gt; Str">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://segmentfault.com/img/bVKURa?w=677&h=266">
<meta property="og:image" content="https://segmentfault.com/img/bVKURg?w=677&h=270">
<meta property="og:image" content="https://segmentfault.com/img/bVKURm?w=677&h=270">
<meta property="og:image" content="https://segmentfault.com/img/bVKURn?w=677&h=270">
<meta property="og:image" content="https://segmentfault.com/img/bVKWA0?w=677&h=306">
<meta property="og:image" content="https://segmentfault.com/img/bVKZb7?w=677&h=278">
<meta property="og:image" content="https://segmentfault.com/img/bVKZcd?w=677&h=690">
<meta property="og:updated_time" content="2021-01-25T12:28:34.593Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="angular2-pipe">
<meta name="twitter:description" content="1&amp;#123;&amp;#123; 输入数据 | 管道 : 管道参数&amp;#125;&amp;#125; Angular 2 内建管道及分类 String -&amp;gt; String UpperCasePipe LowerCasePipe TitleCasePipe   Number -&amp;gt; String DecimalPipe PercentPipe CurrencyPipe   Object -&amp;gt; Str">
<meta name="twitter:image" content="https://segmentfault.com/img/bVKURa?w=677&h=266">
  
    <link rel="alternate" href="/atom.xml" title="Ace&#39;pages" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link rel="stylesheet" href="/css/typing.css">
</head>
</html>
  
    
      <body>
    
  
      <div id="container" class="container">
        <article id="post-angular2-pipe" class="article article-type-post" itemscope="" itemprop="blogPost">
  <header id="header" class="header">
  <nav id="main-nav" class="main-nav">
    
      <a class="main-nav-link" href="/">Home</a>
    
      <a class="main-nav-link" href="/archives">Archives</a>
    
      <a class="main-nav-link" href="/tags/docker">Docker</a>
    
      <a class="main-nav-link" href="/tags/springboot">SpringBoot</a>
    
      <a class="main-nav-link" href="/tags/elasticsearch">ElasticSearch</a>
    
      <a class="main-nav-link" href="/tags/test">Test</a>
    
  </nav>
  <nav id="sub-nav">
    
      <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
    
  </nav>
</header>

  <hr>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      angular2-pipe
    </h1>
  

      </header>
    
    <div class="article-entry typo" itemprop="articleBody">
      
        <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; 输入数据 | 管道 : 管道参数&#125;&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Angular-2-内建管道及分类"><a href="#Angular-2-内建管道及分类" class="headerlink" title="Angular 2 内建管道及分类"></a>Angular 2 内建管道及分类</h5><ul>
<li>String -&gt; String<ul>
<li>UpperCasePipe</li>
<li>LowerCasePipe</li>
<li>TitleCasePipe</li>
</ul>
</li>
<li>Number -&gt; String<ul>
<li>DecimalPipe</li>
<li>PercentPipe</li>
<li>CurrencyPipe</li>
</ul>
</li>
<li>Object -&gt; String<ul>
<li>JsonPipe</li>
<li>DatePipe</li>
</ul>
</li>
<li>Tools<ul>
<li>SlicePipe</li>
<li>AsyncPipe</li>
<li>I18nPluralPipe</li>
<li>I18nSelectPipe</li>
</ul>
</li>
</ul>
<p>angular中的pipe是用来对输入的数据进行处理，如大小写转换、数值和日期格式化等。</p>
<h5 id="常用的pipe有"><a href="#常用的pipe有" class="headerlink" title="常用的pipe有"></a>常用的pipe有</h5><ol>
<li>大小写转换</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123;str | uppercase&#125;&#125;&lt;/p&gt;//转换成大写</span><br><span class="line">&lt;p&gt;&#123;&#123;str | lowercase&#125;&#125;&lt;/p&gt;//转换成小写</span><br></pre></td></tr></table></figure>
<ol>
<li>日期格式转换</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123;today | date:&apos;yyyy-MM-dd HH:mm:ss&apos; &#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>小数位数</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//接收的参数格式为&#123;最少整数位数&#125;.&#123;最少小数位数&#125;-&#123;最多小数位数&#125;</span><br><span class="line">//保留2~4位小数&lt;p&gt;</span><br><span class="line">&#123;&#123;p | number:&apos;1.2-4&apos;&#125;&#125;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>JavaScript 对象序列化</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123; &#123; name: &apos;semlinker&apos; &#125; | json &#125;&#125;&lt;/p&gt;</span><br><span class="line">&lt;!-- Output: &#123; &quot;name&quot;: &quot;semlinker&quot; &#125; --&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>slice</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123; &apos;semlinker&apos; | slice:0:3 &#125;&#125;&lt;/p&gt; </span><br><span class="line">&lt;!-- Output: sem --&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>管道链</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;p&gt;&#123;&#123; &apos;semlinker&apos; | slice:0:3 | uppercase &#125;&#125;&lt;/p&gt; </span><br><span class="line">&lt;!-- Output: SEM --&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>自定义管道</li>
</ol>
<p>自定义管道的步骤：</p>
<ul>
<li>使用 @Pipe 装饰器定义 Pipe 的 metadata 信息，如 Pipe 的名称 - 即 name 属性</li>
<li>实现 PipeTransform 接口中定义的 transform 方法</li>
</ul>
<ol>
<li>WelcomePipe 定义</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Pipe, PipeTransform &#125; from &apos;@angular/core&apos;;</span><br><span class="line">@Pipe(&#123; name: &apos;welcome&apos; &#125;)</span><br><span class="line">export class WelcomePipe implements PipeTransform &#123; </span><br><span class="line">		transform(value: string): string &#123;   </span><br><span class="line">    	if(!value) </span><br><span class="line">    		return value;   </span><br><span class="line">    	if(typeof value !== &apos;string&apos;) &#123;   </span><br><span class="line">    		throw new Error(&apos;Invalid pipe argument for WelcomePipe&apos;); </span><br><span class="line">    &#125;   </span><br><span class="line">    	return &quot;Welcome to &quot; + value; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>WelcomePipe 使用</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;   </span><br><span class="line">	&lt;p ngNonBindable&gt;&#123;&#123; &apos;semlinker&apos; | welcome &#125;&#125;&lt;/p&gt;  </span><br><span class="line">	&lt;p&gt;&#123;&#123; &apos;semlinker&apos; | welcome &#125;&#125;&lt;/p&gt; </span><br><span class="line">	&lt;!-- Output: Welcome to semlinker --&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<ol>
<li>RepeatPipe 定义</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import &#123;Pipe, PipeTransform&#125; from &apos;@angular/core&apos;;</span><br><span class="line">@Pipe(&#123;name: &apos;repeat&apos;&#125;)</span><br><span class="line">export class RepeatPipe implements PipeTransform &#123;</span><br><span class="line">		transform(value: any, times: number) &#123;</span><br><span class="line">			return value.repeat(times);    </span><br><span class="line">		&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li>RepeatPipe 使用</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div&gt;  </span><br><span class="line">		&lt;p ngNonBindable&gt;&#123;&#123; &apos;lo&apos; | repeat:3 &#125;&#125;&lt;/p&gt; </span><br><span class="line">		&lt;p&gt;&#123;&#123; &apos;lo&apos; | repeat:3 &#125;&#125;&lt;/p&gt;</span><br><span class="line">		&lt;!-- Output: lololo --&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>
<h5 id="管道基础"><a href="#管道基础" class="headerlink" title="管道基础"></a>管道基础</h5><p>1、ng g pipe <pipe名称></pipe名称></p>
<p>pipe名称可以带有路径，如pipes/pipename 这样就会在src/app目录生成pipes目录，并在齐目录下生成文件pipename.pipe.ts</p>
<p>2、pipe文件中的代码</p>
<p>(1)、引入相应模块</p>
<p>import { Pipe, PipeTransform } from ‘@angular/core’;</p>
<p>(2)、声明pipe</p>
<p>@Pipe({</p>
<p>　　name: ‘weightChange’</p>
<p>})</p>
<p>name值为代码中需要用到的对应管道的名称</p>
<p>声明pipe时还有另外一个属性pure，接受bool值，用来声明是不是纯管道，默认情况下是纯管道，那么纯管道和非纯管道有什么区别呢？</p>
<p>管道中纯管道和非纯管道之间的区别关键在于：</p>
<p>如果是纯管道，他检测的深读很低，比如检测一个对象数组，对象数组中的对象的某个属性发生变化的时候，纯管道是检测不到的，这时候就需要用到非纯管道。</p>
<p>但是要注意非纯管道对性能影响较大。具体可以参考<a href="https://angular.cn/guide/pipes" target="_blank" rel="noopener">https://angular.cn/guide/pipes</a> 官方解释。</p>
<p>今天我们来介绍一下 Angular 2 中 AsyncPipe (异步管道) ，使用 AsyncPipe 我们可以直接在模板中使用 <code>Promise</code> 和 <code>Observable</code> 对象，而不用通过定义一个类的成员属性来存储返回的结果。</p>
<p>AsyncPipe 订阅一个 Observable 或 Promise 对象，并返回它发出的最新值。 当发出新值时，异步管道会主动调用变化检测器的 <code>markForCheck()</code> 方法，标识组件需执行变化检测。 当组件被销毁时，异步管道自动取消订阅，以避免潜在的内存泄漏。</p>
<h4 id="AsyncPipe-with-Promise"><a href="#AsyncPipe-with-Promise" class="headerlink" title="AsyncPipe with Promise"></a>AsyncPipe with Promise</h4><p><strong>Promise 未使用 AsyncPipe</strong></p>
<p>promise.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;exe-promise&apos;,</span><br><span class="line">    template: `</span><br><span class="line">     &lt;h4&gt;Promise Component&lt;/h4&gt;</span><br><span class="line">     &lt;p&gt;&#123;&#123;promiseData&#125;&#125;&lt;/p&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class PromiseComponent &#123;</span><br><span class="line">    promiseData: string;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.getPromise().then(v =&gt; this.promiseData = v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getPromise(): Promise&lt;string&gt; &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                resolve(&apos;Promise complete!&apos;);</span><br><span class="line">            &#125;, 2000);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;exe-promise&gt;&lt;/exe-promise&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKURa?w=677&amp;h=266" alt="图片描述"></p>
<p><strong>Promise 使用 AsyncPipe</strong></p>
<p>promise-async-pipe.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;exe-promise-pipe&apos;,</span><br><span class="line">    template: `</span><br><span class="line">     &lt;h4&gt;Promise with AsyncPipeComponent&lt;/h4&gt;</span><br><span class="line">     &lt;p&gt;&#123;&#123; promise | async &#125;&#125;&lt;/p&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class PromiseAsyncPipeComponent &#123;</span><br><span class="line">    promise: Promise&lt;string&gt;;</span><br><span class="line">    constructor() &#123;</span><br><span class="line">       this.promise = this.getPromise();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getPromise(): Promise&lt;string&gt; &#123;</span><br><span class="line">        return new Promise((resolve, reject) =&gt; &#123;</span><br><span class="line">            setTimeout(() =&gt; &#123;</span><br><span class="line">                resolve(&apos;Promise with AsyncPipe complete!&apos;);</span><br><span class="line">            &#125;, 2000);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;exe-promise-pipe&gt;&lt;/exe-promise-pipe&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKURg?w=677&amp;h=270" alt="图片描述"></p>
<h3 id="AsyncPipe-with-Observables"><a href="#AsyncPipe-with-Observables" class="headerlink" title="AsyncPipe with Observables"></a>AsyncPipe with Observables</h3><p><strong>Observable 未使用 AsyncPipe</strong></p>
<p>observable.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Observable, Subscription &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line">import &#123; Component, OnDestroy &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;exe-observable&apos;,</span><br><span class="line">    template: `</span><br><span class="line">     &lt;h4&gt;Observable Component&lt;/h4&gt;</span><br><span class="line">     &lt;p&gt;&#123;&#123; observableData &#125;&#125;&lt;/p&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class ObservableComponent implements OnDestroy &#123;</span><br><span class="line">    observableData: number;</span><br><span class="line">    subscription: Subscription = null;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.subscribeObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getObservable(): Observable&lt;number&gt; &#123;</span><br><span class="line">        return Observable</span><br><span class="line">            .interval(1000) // 每隔1秒，生成一个值</span><br><span class="line">            .take(10) // 获取前面10个数据</span><br><span class="line">            .map(v =&gt; v * v); // 对每个数据进行乘方处理</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    subscribeObservable() &#123;</span><br><span class="line">        this.subscription = this.getObservable()</span><br><span class="line">            .subscribe(v =&gt; this.observableData = v);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnDestroy() &#123; // 组件销毁时取消订阅，以避免潜在的内存泄漏</span><br><span class="line">        if (this.subscription) &#123;</span><br><span class="line">            this.subscription.unsubscribe();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;exe-observable&gt;&lt;/exe-observable&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKURm?w=677&amp;h=270" alt="图片描述"></p>
<p><strong>Observable 使用 AsyncPipe</strong></p>
<p>observable-async-pipe.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;exe-observable-pipe&apos;,</span><br><span class="line">    template: `</span><br><span class="line">     &lt;h4&gt;Observable with AsyncPipe Component&lt;/h4&gt;</span><br><span class="line">     &lt;p&gt;&#123;&#123; observable | async &#125;&#125;&lt;/p&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class ObservableAsyncPipeComponent &#123;</span><br><span class="line">    observable: Observable&lt;number&gt;</span><br><span class="line"></span><br><span class="line">    constructor() &#123;</span><br><span class="line">        this.observable = this.getObservable();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getObservable(): Observable&lt;number&gt; &#123;</span><br><span class="line">        return Observable</span><br><span class="line">            .interval(1000)</span><br><span class="line">            .take(10)</span><br><span class="line">            .map(v =&gt; v * v);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>app.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component &#125; from &apos;@angular/core&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;exe-observable-pipe&gt;&lt;/exe-observable-pipe&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent &#123; &#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKURn?w=677&amp;h=270" alt="图片描述"></p>
<p>为了更让读者更好地掌握 AsyncPipe， 我们再来一个示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line"></span><br><span class="line">interface Hero &#123;</span><br><span class="line">    id: number;</span><br><span class="line">    name: string;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">    selector: &apos;async-pipe-example&apos;,</span><br><span class="line">    template: `</span><br><span class="line">       &lt;h4&gt;Async Pipe Example&lt;/h4&gt;</span><br><span class="line">       &lt;div&gt;</span><br><span class="line">          &lt;h5&gt;Heroes: &lt;/h5&gt;</span><br><span class="line">          &lt;ul&gt;</span><br><span class="line">            &lt;li *ngFor=&quot;let hero of heroes$ | async&quot;&gt;</span><br><span class="line">                &#123;&#123; hero.name &#125;&#125;</span><br><span class="line">            &lt;/li&gt;</span><br><span class="line">          &lt;/ul&gt; </span><br><span class="line">          &lt;h5&gt;Hero: &lt;/h5&gt;</span><br><span class="line">          &lt;p&gt; </span><br><span class="line">            &lt;span *ngIf=&quot;hero$&quot;&gt;&#123;&#123; (hero$ | async).id &#125;&#125;&lt;/span&gt;</span><br><span class="line">            &lt;span&gt;&#123;&#123; (hero$ | async)?.name &#125;&#125;&lt;/span&gt;</span><br><span class="line">          &lt;/p&gt;</span><br><span class="line">       &lt;/div&gt;</span><br><span class="line">    `</span><br><span class="line">&#125;)</span><br><span class="line">export class AsyncPipeComponent implements OnInit &#123;</span><br><span class="line">    heroes$: Observable&lt;Hero[]&gt;;</span><br><span class="line">    hero$: Observable&lt;Hero&gt;;</span><br><span class="line"></span><br><span class="line">    getHeroes(): Observable&lt;Hero[]&gt; &#123;</span><br><span class="line">        return Observable.of([</span><br><span class="line">            &#123; id: 1, name: &apos;Windstorm&apos; &#125;,</span><br><span class="line">            &#123; id: 13, name: &apos;Bombasto&apos; &#125;,</span><br><span class="line">            &#123; id: 15, name: &apos;Magneta&apos; &#125;,</span><br><span class="line">            &#123; id: 20, name: &apos;Tornado&apos; &#125;</span><br><span class="line">        ]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    getHero(): Observable&lt;Hero&gt; &#123;</span><br><span class="line">        return Observable.of(&#123;</span><br><span class="line">            id: 31, name: &apos;Semlinker&apos;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ngOnInit() &#123;</span><br><span class="line">        setTimeout(() =&gt; &#123;</span><br><span class="line">            this.heroes$ = this.getHeroes();</span><br><span class="line">            this.hero$ = this.getHero();</span><br><span class="line">        &#125;, 2000);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKWA0?w=677&amp;h=306" alt="图片描述"></p>
<p>上面例子中有两个注意点：</p>
<p>1.使用 <code>ngIf</code> 控制 <code>span</code> 元素的显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span *ngIf=&quot;hero$&quot;&gt;&#123;&#123; (hero$ | async).id &#125;&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>2.使用 <code>?.</code> 安全导航操作符，控制 <code>name</code> 属性的显示：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;&#123;&#123; (hero$ | async)?.name &#125;&#125;&lt;/span&gt;</span><br></pre></td></tr></table></figure>
<p>若去掉 <code>ngIf</code> 或 <code>?.</code> ，应用程序将会抛出异常，建议读者亲身体验一下。</p>
<h3 id="我有话说"><a href="#我有话说" class="headerlink" title="我有话说"></a>我有话说</h3><p>1.Promise vs Observable</p>
<ul>
<li>Promise<ul>
<li>返回单个值</li>
<li>不可取消的</li>
</ul>
</li>
<li>Observable<ul>
<li>随着时间的推移发出多个值</li>
<li>可以取消的</li>
<li>支持 map、filter、reduce 等操作符</li>
<li>延迟执行，当订阅的时候才会开始执行</li>
</ul>
</li>
</ul>
<p>详细内容可以参考 - <a href="https://segmentfault.com/a/1190000005051034#articleHeader0" target="_blank" rel="noopener">RxJS 核心概念之Observable</a></p>
<p>2.使用 AsyncPipe 会发送多次请求</p>
<p>我们直接看一下具体示例：</p>
<p>app.component.ts</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Http &#125; from &apos;@angular/http&apos;;</span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.body &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  person$: Observable&lt;&#123; id: number; title: string; body: string &#125;&gt;;</span><br><span class="line"></span><br><span class="line">  constructor(private http: Http) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.person$ = this.http.get(&apos;https://jsonplaceholder.typicode.com/posts/1&apos;)</span><br><span class="line">      .map(res =&gt; res.json())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后能正常显示结果，但如果你切换到开发者工具的网络面板，你会发现发送了三个重复的请求。这是因为我们的 Observable 是 <a href="https://blog.thoughtram.io/angular/2016/06/16/cold-vs-hot-observables.html" target="_blank" rel="noopener">cold</a> 的，每处使用 async 管道的地方都会执行一次。针对上述问题，大部分人推荐的解决方案如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.http.get(&apos;https://jsonplaceholder.typicode.com/posts/1&apos;)</span><br><span class="line">     .map(res =&gt; res.json()).share()</span><br></pre></td></tr></table></figure>
<p>我们只需使用 RxJS 中的共享操作符，它在内部调用 publish().refCount()。是不是很开心，但先等等，还有一种情况又会触发 HTTP 请求，具体我们再来看一下示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Http &#125; from &apos;@angular/http&apos;;</span><br><span class="line">import &#123; Observable &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.body &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button (click)=&quot;showPersonInfo()&quot;&gt;显示用户ID&lt;/button&gt;</span><br><span class="line">      &lt;p *ngIf=&quot;isShow&quot;&gt;&#123;&#123; (person$ | async)?.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  person$: Observable&lt;&#123; id: number; title: string; body: string &#125;&gt;;</span><br><span class="line">  isShow: boolean = false;</span><br><span class="line"></span><br><span class="line">  constructor(private http: Http) &#123; &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.person$ = this.http.get(&apos;https://jsonplaceholder.typicode.com/posts/1&apos;)</span><br><span class="line">      .map(res =&gt; res.json())</span><br><span class="line">      .share();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  showPersonInfo() &#123;</span><br><span class="line">    this.isShow = true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码运行后浏览器显示的结果：</p>
<p><img src="https://segmentfault.com/img/bVKZb7?w=677&amp;h=278" alt="图片描述"></p>
<p>我们发现当点击 ‘显示用户ID’ 按钮时，又触发了新的请求。看来我们的救世主 - <code>share()</code> 不给力了，幸运的是我们还有新的救世主 - <code>publishReplay()</code>，具体代码如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">import &#123; Component, OnInit &#125; from &apos;@angular/core&apos;;</span><br><span class="line">import &#123; Http &#125; from &apos;@angular/http&apos;;</span><br><span class="line">import &#123; Observable, ConnectableObservable &#125; from &apos;rxjs/Rx&apos;;</span><br><span class="line"></span><br><span class="line">@Component(&#123;</span><br><span class="line">  selector: &apos;exe-app&apos;,</span><br><span class="line">  template: `</span><br><span class="line">   &lt;div&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.title &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;p&gt;&#123;&#123; (person$ | async)?.body &#125;&#125;&lt;/p&gt;</span><br><span class="line">      &lt;button (click)=&quot;showPersonInfo()&quot;&gt;显示用户ID&lt;/button&gt;</span><br><span class="line">      &lt;p *ngIf=&quot;isShow&quot;&gt;&#123;&#123; (person$ | async)?.id &#125;&#125;&lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  `</span><br><span class="line">&#125;)</span><br><span class="line">export class AppComponent implements OnInit &#123;</span><br><span class="line">  person$: ConnectableObservable&lt;&#123; id: number; title: string; body: string &#125;&gt;;</span><br><span class="line">  isShow: boolean = false;</span><br><span class="line"></span><br><span class="line">  constructor(private http: Http) &#123;</span><br><span class="line">    this.preparePersonInfo();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  ngOnInit() &#123;</span><br><span class="line">    this.person$.connect();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  preparePersonInfo() &#123;</span><br><span class="line">    this.person$ = this.http.get(&apos;https://jsonplaceholder.typicode.com/posts/1&apos;)</span><br><span class="line">      .map(res =&gt; res.json())</span><br><span class="line">      .publishReplay()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  showPersonInfo() &#123;</span><br><span class="line">    this.isShow = true;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>我们使用 publishReplay 替换了 share 操作符。调用 publishReplay() 方法后将返回一个ConnectableObservable 对象，当你调用 connect() 方法的时候，将主动执行订阅操作。</p>
<p>是不是感觉快奔溃了，就想简单的获取用户的信息，然后使用 AsyncPipe，怎么就那么多坑。。。</p>
<p>在大多数情况下，我们只需要从服务器获取数据并显示数据。如果只是这样的话，我们可以使用 Promise 来修复 AsyncPipe 发送多次 HTTP 请求的问题：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">this.person = this.http.get(&quot;https://jsonplaceholder.typicode.com/posts/1&quot;)</span><br><span class="line"> .map(res =&gt; res.json()).toPromise()</span><br></pre></td></tr></table></figure>
<p>3.AsyncPipe 执行流程</p>
<p><img src="https://segmentfault.com/img/bVKZcd?w=677&amp;h=690" alt="图片描述"></p>
<p>接下来我们看一下 PromiseStrategy 与 ObservableStrategy 策略：</p>
<p>SubscriptionStrategy 接口</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">interface SubscriptionStrategy &#123;</span><br><span class="line">  createSubscription(async: any, updateLatestValue: any): any;</span><br><span class="line">  dispose(subscription: any): void;</span><br><span class="line">  onDestroy(subscription: any): void;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>PromiseStrategy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class PromiseStrategy implements SubscriptionStrategy &#123;</span><br><span class="line">  createSubscription(async: Promise&lt;any&gt;, </span><br><span class="line">    updateLatestValue: (v: any) =&gt; any): any &#123;</span><br><span class="line">      return async.then(updateLatestValue, e =&gt; &#123; throw e; &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  dispose(subscription: any): void &#123;&#125;</span><br><span class="line">  onDestroy(subscription: any): void &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ObservableStrategy</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class ObservableStrategy implements SubscriptionStrategy &#123;</span><br><span class="line">  createSubscription(async: any, updateLatestValue: any): any &#123;</span><br><span class="line">    return async.subscribe(&#123;next: updateLatestValue, </span><br><span class="line">       error: (e: any) =&gt; &#123; throw e; &#125;&#125;);</span><br><span class="line">  &#125;</span><br><span class="line">  dispose(subscription: any): void &#123; subscription.unsubscribe(); &#125;  // 取消订阅</span><br><span class="line">  onDestroy(subscription: any): void &#123; subscription.unsubscribe(); &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这篇文章我们介绍了 AsyncPipe 如何搭配 Promise 和 Observable 使用，此外介绍了 AsyncPipe 会发送多次请求的问题，最后我们得出的结论是如果只是需要从服务器获取数据并显示数据，可以使用 Promise 来修 AsyncPipe 发送多次 HTTP 请求的问题。</p>

      
    </div>
    <footer class="article-footer">
      <ul class="article-meta">
        <li>
          <span class="label">Published Date:</span>
          <a href="/2020/04/06/angular2-pipe/" class="article-date">
  <time datetime="2020-04-05T17:00:36.000Z" itemprop="datePublished">2020-04-06</time>
</a>

        </li>
        
        
        <hr>
      </ul>
    </footer>
  </div>
  
    
<nav id="article-nav" class="article-nav">
  
    <a href="/2020/04/06/angular2-route-1/" id="article-nav-newer" class="article-nav-link-wrap newer">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          angular2-route
        
      </div>
    </a>
  
  
    <a href="/2020/04/06/angular2-service/" id="article-nav-older" class="article-nav-link-wrap older">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">angular2-service</div>
    </a>
  
</nav>


  
</article>




      </div>
      
    <footer id="footer" class="post-footer footer">
      <hr>
      <div id="footerContent" class="footer-content">
        <p>闲步山雨后,静待晚林风 Post</p>


      </div>
    </footer>

      

<script src="//cdn.bootcss.com/jquery/2.2.4/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/typing.js"></script>
<!--[if lt IE 9]><script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7/html5shiv.min.js"></script><![endif]-->







    </div>
  </body>
</html>
